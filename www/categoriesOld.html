<html>

<head>
  <!-- BoxItNow CSS -->
  <link rel="stylesheet" type="text/css" href="http://localhost/boxitnow/css/bin.cache.min.css" />

  <link rel="stylesheet" type="text/css" href="css/wizard.css" />




    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

</head>


<body>

<div class="back-wizard" >
        <div id="step1" class="wizard" >
            <div id="close">&times;</div>
            <div id="substep1" class="wizardTitles">Start by choosing a category.</div>
            <div id="categories" class="select" >  </div>


            <div id="items" class="select"><p id="instructionBox">Choose a category to view styles.</p></div>
            <div id="preview">
                <div id="view3d"><p>3D</p></div>
                <div id="name">Name</div>
                <div id="desc">Description</div>
                <div id="next" class="wizard-btn" style="display:none">Next</div>
            </div>
            <br style="clear:both;"/>
        </div>

        <div id="step2" class="wizard" style="display: none" >
            <div id="close">&times;</div>
            <div id="substep4" class="wizardTitles">What would you like to do with your item?</div>
            <div id="preview" >
                <div id="view3d" ><p>3D</p></div>
                <div id="name">Name</div>
                <div id="desc">Description</div>
                <div id="table">
                    <table id="boxInfo" border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr class="odd_row">
                                <td id="param1" class="label">Length</td>
                                <td id="value1" class="value endCol1">12.00000</td>
                                <td id="param4" class="label">Material</td>
                                <td id="value4"  class="value">32 ECT B</td>
                            </tr>
                            <tr class="even_row">
                                <td id="param2" class="label">Width</td>
                                <td id="value2"  class="value endCol1">12.00000</td>
                                <td id="param5" class="label">Allowance</td>
                                <td id="value5"  class="value">2.50000</td>
                            </tr>
                            <tr class="odd_row">
                                <td id="param3" class="label">Depth</td>
                                <td id="value3"  class="value endCol1">3.50000</td>
                                <td id="param6" class="label">Radius</td>
                                <td id="value6" class="value">Value</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="back" class="wizard-btn" >&#8678; Back</div>
            </div>
            <div id="actions">
                <div class="wizard-btn action-btn" action="measurements" >Change dimensions</div>
                <div class="wizard-btn action-btn" action="graphics" >Customize colors &amp; graphics</div>
                <div class="wizard-btn action-btn" action="graphics" >Add full page graphic</div>
                <div class="wizard-btn action-btn" action="export" >Share it</div>
            </div>
            <br style="clear:both;"/>
        </div>

    </div>



  </body>




  <script>

  var categories;
  var selectedItem;


  $(document).on('ready', function () {

    var url = "https://localhost/boxitnow/api/category";
    var data = "";

    $.get(url, data, function (d) {

        console.log(d);
        categories = JSON.parse(d);
        var temp = JSON.parse(d);

        for(var i =0; i<temp.length; i++){
          var newT = "<div class='category' rel='" + i/*temp[i].categoryGroupRefNo*/ + "' >"
            + "<div class='imageBox'><img src='" + temp[i].image1 + "'</div>"
            + "<p class='CatName']]>" +   temp[i].categoryGroupName + " </p>"
            + "</div>";

            $('#categories').append(newT);
        }

        addCategoryClick();

    });



    /*var view3d = new WebGlViewer3d("<?php echo Yii::app()->request->baseUrl ?>");
    view3d.mouseSpeed = 4;
    view3d.tagElement = $("#step1 #view3d");
    view3d.webGLWidth = view3d.tagElement.width();
    view3d.webGLHeight = view3d.tagElement.height();
    view3d.viewAngleX += Math.PI;
    view3d.initialize();
    view3d.animate();*/

    //var categories = {<?php echo implode(',', $categoryJson) ?>};



    $("#wizard-dialog").click(function () {
        $(this).hide();
    });
    $(".back-wizard").click(function (event) {
        event.stopPropagation();
    });
    $(".back-wizard #close").click(function (event) {
        $("#wizard-dialog").hide();
    });

    $(".show-wizard").click(function (event) {
        $("#wizard-dialog").show();
    });


    $("#view3d p").hide();

    $(".category").hover(function () {
        var category = categories[$(this).attr('rel')];
        $("#step1 #desc").html(category.desc);
        $("#preview #name").html(category.name);
    });


    $('.action-btn').click(function () {
        /*if (selectedItem.access === '1'){
            window.location ="test.php?id=" + selectedItem.id; // + "?action=" + $(this).attr('action');
          }
        else{
            window.location = "test.php";
          }*/


          window.location ="test.php?id=" + selectedItem.itemRefNo;

    });

    $("#next").click(function () {


        $("#step1").hide("slide", {direction: "left"}, 200);
        $("#step2").show("slide", {direction: "right"}, 200);

        // $(".ui-effects-wrapper").css({position: "fixed"});
        //$(".ui-effects-wrapper").offset({left:0,top:0});
        $(".ui-effects-wrapper").css({"margin-bottom": "-520px"});
        //view3d.appendTo($("#step2 #view3d"));
    });

    $("#back").click(function () {
        $("#step2").hide("slide", {direction: "right"}, 200);
        $("#step1").show("slide", {direction: "left"}, 200);
        $(".ui-effects-wrapper").css({"margin-bottom": "-520px"});
      //  view3d.appendTo($("#step1 #view3d"));
    });



      });



      function addCategoryClick(){

        $(".category").click(function () {

            console.log("!!" + $(this).attr('rel'));

            $("#items").addClass("active");
            $(".category").removeClass('selected');
            $(this).addClass('selected');
            var is = $("#items");
            is.empty();
            var category = categories[$(this).attr('rel')];

            getCategoryInfo(category.categoryGroupRefNo);

            var textStep_1_2 = "Now choose a style.";//"Step 2: You've selected " + category.name +
            $("#substep1").html(textStep_1_2);

          /*  var its = items;category.items;
            for (var i in its) {
                var item = its[i];
                console.log(item.name);
                //var src = '<?php echo Utilities::getItemWebPath() ?>' + item.nid + "/" + item.nid + "_3d.png";
                var img = ' <div class="imageBox" />'; //<img src=' + src + ' /></div>';
                is.append('<div class="item" rel="' + i + '" >' + img + '<p class="BoxName">' + item.name + '</p>' + '</div>');
            }*/

        });


      }

      var items;

      function getCategoryInfo(cid){

        var data = "";
        var url = "https://localhost/boxitnow/api/category/"+cid;

        $.get(url, data, function (d) {

            console.log(d);
            items = JSON.parse(JSON.stringify(d));
            items = items.items;

            var is = $("#items");
            is.empty();

            var its = items;
            for (var i in its) {
                var item = its[i];
                console.log(item);
                var src = '<?php echo Utilities::getItemWebPath() ?>' + item.nid + "/" + item.nid + "_3d.png";
                var img = ' <div class="imageBox" ><img src=' + item.image + ' /></div>';
                is.append('<div class="item" rel="' + i + '" >' + img + '<p class="BoxName">' + item.itemShortDesc + '</p>' + '</div>');
            }

            addItemClick();

        });

      }


      function addItemClick(){

        $(".item").click(function () {

          $('.wizard-btn').show();

            $("#view3d p").show();
            $("#step1 #next").addClass("active");
            var textStep_1_3 = "Click \"NEXT\" to start customizing your item.";
            $("#substep1").html(textStep_1_3);
            $(".item").removeClass('selected');
            $(this).addClass('selected');

            var item = items[$(this).attr('rel')];
            selectedItem = item;

            $("#step1 #desc").html(item.itemShortDesc);
            $("#step2 #desc").html(item.itemLongDesc2);
            $("#preview #name").html(item.itemShortDesc);
            //"<?php echo $this->createUrl('itemJson') ?>?id=" + item.id
            var src = 'https://localhost/data/site/design/' + item.itemQuickDesc + "/" + item.itemQuickDesc + "_json.json";
            //var src = item.image + "_json.json";
            $.get(src, null, function (data) {
                data = JSON.parse(JSON.stringify(data));
              //  view3d.loadJson(data);
              //  view3d.angle = view3d.getMaxFold() + 0.9;
                console.log(data);

                $("#value1").html(data.parameters.Length || 'N/A');
                $("#value2").html(data.parameters.Width || 'N/A');
                $("#value3").html(data.parameters.Depth || 'N/A');
                $("#value5").html(data.parameters.Allowance || 'N/A');
                var key;
                for (var i in data.parameters) {
                    if (i === "Radius") {
                        key = i;
                        break;
                    }
                    if ((i !== 'Length') && (i !== 'Width') && (i !== 'Depth') && (i !== 'Allowance') &&
                            (i !== 'Scale') && (i !== 'allowance') && (i !== 'clean_panels'))
                        key = i;

                }

                $("#param6").html(key || '');
                $("#value6").html(data.parameters[key] || '');


            });
        });
      }


  </script>


  </html>
